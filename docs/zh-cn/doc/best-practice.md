# 最佳实践模式

依据项目所使用的代码分支管理模式，可以配合虚拟环境形成最优化的研发实践。

以Gitflow为例，首先用流水线将`develop分支`自动部署到测试环境并为相应Deployment资源的Pob模板加上`dev`标签，这些Pod将被作为环境中的默认调用实例，类似于一个虚拟出来的“公共测试环境”。

开发者如果不想使用某个服务在`develop分支`上的版本，可以自己用`feature分支`上打出的镜像部署一个“项目环境”，并打上一个子级标签，比如`dev.proj-1`。同时还可以把这个环境分享给其他依赖这个版本的服务的其他开发者（通常他们也都工作在同一个特定项目上）。

开发者本地的服务实例也可以加入到项目环境的隔离域中（同在一个隔离域中的其他本地实例就可以优先调用过来）。也可基于指定项目环境或公共环境，单独创建一个子级虚拟环境，分别使用比如`dev.proj-1.jinji`或`dev.jinji`标签，称为“个人环境”（能在方便自己进行测试或调试的前提下，确保其他开发者的调用不会进入到自己的本地服务实例）。

最终形成使用三层隔离链路的测试环境模式，如下图所示。

![best-practice-zh-cn.jpg](https://img.alicdn.com/imgextra/i3/O1CN0102do1U1UjJrJ7LiSI_!!6000000002553-0-tps-2322-1320.jpg)

- **公共环境**：包含完整服务链路，作为依赖兜底，部署相对稳定的服务版本
- **项目环境**：包含某个子项目涉及的服务，用于协作联调，部署项目调试所需的特定服务版本
- **个人环境**（包括本地服务）：包含服务最少，用于个人调试

这种三层虚拟环境使用模式对其他分支管理模式同样适用。
